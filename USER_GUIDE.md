# codex-sidecar 用户操作指南（手把手）

这份文档的目标很简单：**告诉你“点哪里 / 做什么 / 你会看到什么”**。  
你不需要看源码，也不需要理解实现原理。

如果你只记住两件事就够用了：
1) 在终端运行：`./run.sh`  
2) 在浏览器打开：`http://127.0.0.1:8787/ui`

本仓库还提供两份“更深/更全”的资料（可选）：
- `README.DRAFT.md`：信息挖掘版（更像索引/清单）
- `README.ENCYCLOPEDIA.md`：百科全书版（更像原理/边界解释）

---

## 0. 你先知道这 3 件事（很重要，但不费脑子）

1) sidecar **只读**你的会话文件：不会修改 `rollout-*.jsonl`。  
2) sidecar **不接管** Codex：网页里不会有“输入框去控制 Codex 执行”。  
3) sidecar **只能提醒你**去终端确认：终端里弹出的批准/拒绝，你仍要回终端点。

---

## 1. 第一次使用（从 0 到“看见会话”）

### 1.1 启动（推荐：一键即用）

1) 打开终端，进入本仓库根目录（你能看到 `run.sh`）。  
2) 运行：`./run.sh`  
3) 浏览器打开：`http://127.0.0.1:8787/ui`

你应该看到：
- 页面标题是 “Codex Sidecar · 会话旁路监视”
- 右侧有一列按钮（Dock）
- 右侧还有一列“会话标签栏”（像书签一样的窄条）

如果你打不开网页：跳到「5.1 打不开网页 / 一直转圈」。

### 1.2 我怎么判断它有没有在“监听”？

看右侧 Dock 里写着“开始监听 / 停止监听”的按钮：
- 显示“停止监听”：说明已经在监听中（常见于 `./run.sh`）。  
- 显示“开始监听”：点一下就开始监听（常见于 `./run.sh --ui`）。

提示：`./run.sh --ui` 的意义是“先把 UI 开起来”，默认不自动开始监听（适合你想先把设置调好、或只离线回看/导出）。

### 1.3 看不到任何会话怎么办？

最常见原因只有两种：
- 你还没用 Codex 跑过对话（所以没有会话文件）。  
- 你的 `CODEX_HOME` 不在默认位置。

先按最省事的做法排查（按顺序来）：
1) 先去用一次 Codex 跑一个简单对话（确保它产生会话记录）。  
2) 回到 sidecar UI 点一下“停止监听”，再点“开始监听”。  
3) 还是没有：跳到「5.3 UI 打开了，但没有任何会话/消息」。

---

## 2. UI 认识（你只需要认这几块）

### 2.1 三个区域（你每天都用）

1) **会话标签栏**（右侧书签条）  
   - 用来在不同会话之间切换  
   - 会显示未读提示（有小徽标）

2) **主时间线**（中间的大列表）  
   - 你看到的所有内容都在这里：用户输入、回答、思考、工具输出、终端确认提醒……

3) **Dock（右侧一列按钮）**  
   - 你几乎所有操作都从这里开始：设置、导入、精简显示、翻译、开始/停止监听、清空、关闭/重启

找不到按钮名字时的小技巧：把鼠标放上去停一下，会出现提示文字（按钮都有清晰的中文 `aria-label`）。

### 2.2 Dock 按钮一览（从上到下）

- **设置**：打开设置抽屉（改字体/按钮大小、提示音、自动开始等）  
- **导入对话**：离线导入某个历史 `rollout-*.jsonl` 用于回看/导出  
- **精简显示**：单击切换“精简/全量”；长按打开“精简显示设置”  
- **翻译**：单击切换自动翻译；长按打开“翻译设置”  
- **开始监听 / 停止监听**：控制是否实时跟随最新会话  
- **清空消息**：清空当前页面里的内容（不会删会话文件）  
- **关闭/长按重启**：单击退出 sidecar；长按重启 sidecar

### 2.3 右下角三个小按钮（容易被忽略，但很好用）

页面右下角有三个按钮：
- **回到页面顶部**
- **回到页面底部**
- **会话管理**：打开“会话管理”抽屉（重命名/导出/关闭监听/管理离线展示）

---

## 3. 最常用操作（按“你要做什么”来）

### 3.1 我只想“正常使用”——就按这条主线走

这条主线适合 90% 的情况（实时跟随最新会话）：
1) 终端运行 `./run.sh`  
2) 打开 `http://127.0.0.1:8787/ui`  
3) 右侧 Dock 确认是“停止监听”（表示正在监听）  
4) 在右侧“会话标签栏”点最新的会话（通常在最上方/最醒目）  
5) 在时间线里看“回答”和“思考”即可

### 3.2 我想先开 UI，不要它自动开始监听

适合场景：你只想离线导入回看/导出，或者想先把设置调好再开始监听。

1) 终端运行：`./run.sh --ui`  
2) 打开 `http://127.0.0.1:8787/ui`  
3) 需要实时跟随时，再点 Dock 的“开始监听”

### 3.3 我想切换会话（只看某一个 / 看全部）

你有两个入口：
- **右侧会话标签栏**：最快，适合“只是在几个会话之间切换”  
- **会话管理抽屉**：更全面，适合“重命名/导出/关闭监听/找离线会话”

切回“全部会话”：
- 在会话标签栏选择 `all`（如果你不确定，直接在会话管理里点 `all` 也行）

### 3.4 我想把页面变“清爽”——只看我关心的块

你想少看工具细节、多看结果时，用“精简显示”：
- 单击 Dock 的“精简显示”：在“精简/全量”之间切换  
- 长按 Dock 的“精简显示”：打开“精简显示设置”，你可以勾选精简模式下要保留哪些块

常见推荐：
- 想复盘决策：保留“回答 / 思考 / 终端确认”即可  
- 想排障：切回“全量”

### 3.5 我想把“思考”翻译成中文（自动 / 手动）

你会在“思考”块右侧看到：
- 一个状态（例如“待翻译/翻译中/已翻译/翻译失败”）  
- 一个按钮（例如“翻译/重试/重译”）

最省事的做法（自动翻译）：
1) 单击 Dock 的“翻译”按钮，把自动翻译打开  
2) 长按 Dock 的“翻译”按钮，打开“翻译设置”  
3) 选择一个你能用的 Provider（HTTP / GPT / NVIDIA），把需要的 Token/API Key 填好  
4) 点“保存”  
5) 回到时间线，等一会儿：思考块会逐步出现中文（原位回填，不会打乱时间线）

手动翻译的用法（你想“自己点了才翻”）：
1) 长按 Dock 的“翻译”按钮 → 翻译设置  
2) 把“自动翻译”改成“关闭（手动）”并保存  
3) 回到时间线：  
   - 点击某条“思考”块（没有中文时会触发翻译）  
   - 或点右侧的“翻译/重试/重译”按钮

隐私提醒：翻译意味着把文本发送到你配置的翻译服务（可能是公网），请按你的安全要求选择 Provider。

### 3.6 我想导出一份 Markdown（复盘/分享）

导出入口在“会话管理”里：
1) 点右下角的“会话管理”（菜单按钮）  
2) 在“监听中 / 展示中”的某个会话行里，点“导出”按钮  
3) 等浏览器下载完成（文件在你的默认下载目录）

导出偏好（精简/全量、译文/原文）：
- 在“导出”按钮上长按，会打开“导出设置”  
- 你可以按会话分别设置偏好（例如：给别人看用“精简+译文”，自己排查用“全量+原文”）

### 3.7 我想离线回看某一天的对话（不影响当前监听）

1) 点 Dock 的“导入对话”  
2) 在弹窗里：
   - 输入框里填 `sessions/YYYY/MM/DD/rollout-*.jsonl`  
   - 或从下面的列表里直接点选  
3) 点“导入”

导入后的会话会出现在页面顶部的“展示标签栏”（离线标签栏）：
- “展示中”的会话用于回看/导出  
- 不会影响你正在监听的在线会话

小技巧：如果你手上只有“完整路径”，直接粘贴也可以；UI 会尽量帮你提取成 `sessions/...` 的相对路径。

### 3.8 我想重命名会话 / 关闭监听某个会话 / 恢复

这些都在“会话管理”里完成：
1) 点右下角“会话管理”打开抽屉  
2) 找到你要操作的会话（在“监听中 / 展示中 / 关闭监听”里）  
3) 在会话行右侧：
   - 点“重命名”修改显示名（只影响本机 UI 显示，不会改会话文件）  
   - 点“移除展示”把离线导入的会话从“展示中”移走  
   - 把某个会话“关闭监听”（不想让它再自动出现/提醒）  
   - 需要时再从“关闭监听”里恢复

小技巧：在会话行上长按，可以复制该会话的源 JSON 路径（用于定位文件/分享给懂的人排查）。

### 3.9 UI 提示“终端确认（等待中）”，我该怎么办？

含义：Codex 可能在终端里弹出了“需要你批准/拒绝”的提示，你没注意到。

你要做的事只有一件：
1) 回到你运行 Codex 的终端  
2) 找到那条“确认/批准/拒绝”的提示并作出选择  
3) 再回到 sidecar UI，看状态是否消失/更新

注意：sidecar 不会替你在终端里点确认，它只负责提醒与展示。

### 3.10 我想把字体/按钮调大一点（看得更舒服）

1) 点 Dock 的“设置”  
2) 找到：
   - “字体大小”（单位 px）  
   - “按钮大小”（单位 px）  
3) 改完点“保存”

### 3.11 我想设置提示音（或换成我自己的音效）

1) 点 Dock 的“设置”  
2) 在“回答提示音 / 终端确认提示音”里选择你喜欢的  
3) 改完点“保存”

如果你想放自己的音效：
1) 把音频文件放到：`config/sidecar/sounds/`  
2) 支持格式：`.ogg` / `.mp3` / `.wav`（单文件最大 1 MiB）  
3) 回到页面重新打开“设置”，下拉框里会出现你的自定义音效

### 3.12 我想“关掉/重启” sidecar

右侧 Dock 有“关闭/长按重启”按钮：
- 单击：弹出确认框，确认后退出 sidecar  
- 长按：跳过确认，直接重启 sidecar（适合卡住时快速恢复）

提示：退出/重启只影响 sidecar，不会影响 Codex 本体，也不会删除你的会话文件。

---

## 4. 你可能会关心的“不会误伤”的说明

1) “清空消息”只清空当前页面里的内容，不会删除 `CODEX_HOME` 里的会话文件。  
2) 关闭浏览器标签页不会停止 sidecar；要停止请回到运行 `./run.sh` 的终端按 `Ctrl+C`。  
3) 本机配置默认写在 `config/sidecar/config.json`，并且已加入 `.gitignore`（避免你把 Token/API Key 提交进仓库）。

---

## 5. 排障（按你看到的现象来）

### 5.1 打不开网页 / 一直转圈

1) 先确认终端里 `./run.sh` 没有报错退出。  
2) 再确认你打开的是：`http://127.0.0.1:8787/ui`  
3) 如果你改过端口（例如 `PORT=8788 ./run.sh`），网址也要改成对应端口。

### 5.2 提示端口占用 / 启动失败

最省事的处理方式：
- 换一个端口启动：`PORT=8788 ./run.sh`

### 5.3 UI 打开了，但没有任何会话/消息

按顺序排查：
1) 先确认你真的在用 Codex 跑过对话，并且它会写入会话目录。  
2) 如果你的 Codex 数据目录不在默认 `~/.codex`，用任意一种方式显式指定：  
   - `CODEX_HOME=/你的路径 ./run.sh`  
   - 或 `./run.sh --codex-home /你的路径`  
3) 如果你是用 `./run.sh --ui` 启动的：记得在页面点一次“开始监听”。

### 5.4 思考翻译一直失败 / 没反应

最常见原因：Provider 没配好（URL/Token/API Key 缺失或不可用）。

建议你这样做：
1) 长按 Dock 的“翻译”打开翻译设置  
2) 选择一个你能用的 Provider，并把需要的字段填好  
3) 点“保存”  
4) 回到时间线，对某条思考点“翻译/重试/重译”观察是否恢复

### 5.5 导出点了没反应，或提示 `export_in_flight`

含义：你短时间内点了两次导出，前一次还在进行中。  
处理：等 2–5 秒再试一次。

