# 技术设计: 后端架构分层优化（Phase 3）

## 技术方案
### 核心技术
- Python 3.8（保持现状）
- 重构策略：facade（对外兼容）+ 内部模块拆分（单一职责）

### 实现要点
- 将“大类/大文件”中**可独立复用且无状态**的逻辑抽到 `watch/` 子模块（例如：去重缓存、rollout 行解析与 ingest、文件 tail 复用）。
- 通过 **callable 注入** 而非强耦合 import，降低循环依赖与导入副作用风险。
- 保持既有公开入口与行为：
  - 旧 import 路径继续可用（facade 文件不变或仅做轻改）
  - status/config 输出字段与语义不变（必要时加测试兜底）

## 架构设计
本轮为“内部拆分”，不引入新的对外架构决策；保持现有 HTTP/API/UI 协议。

## 安全与性能
- **安全:** 不新增外部网络访问逻辑；不引入明文密钥/令牌；保持现有脱敏/恢复逻辑。
- **性能:** 以“减少不必要的扫描与导入开销”为主；不引入额外轮询与阻塞。

## 测试与部署
- **测试:** `python3 -m unittest discover -s tests`
- **质量检查:** `python3 -m compileall -q codex_sidecar`
- **手工 smoke（可选）:** `./run.sh` 启动后检查 `/health`、`/api/status`

