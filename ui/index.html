<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Codex Sidecar · 会话旁路监视</title>
    <link rel="stylesheet" href="/ui/vendor/katex/katex.min.css" />
    <link rel="stylesheet" href="/ui/styles.css" />
		  </head>
				  <body data-bm-skin="default">
	          <div id="bookmarks" class="bookmarks" aria-label="会话标签栏">
	            <div class="bm-rail" aria-label="会话标签"></div>
	          </div>
		          <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute; width:0; height:0; overflow:hidden" aria-hidden="true" focusable="false">
		            <symbol id="i-settings" viewBox="0 0 24 24">
		              <path d="M12 15.5a3.5 3.5 0 1 0 0-7a3.5 3.5 0 0 0 0 7z"></path>
		              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33a1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
		            </symbol>
		            <symbol id="i-bookmark" viewBox="0 0 24 24">
		              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
		            </symbol>
		            <symbol id="i-bolt" viewBox="0 0 24 24">
		              <path d="M13 2L3 14h7l-1 8 10-12h-7z"></path>
		            </symbol>
	            <symbol id="i-globe" viewBox="0 0 24 24">
	              <circle cx="12" cy="12" r="10"></circle>
	              <path d="M2 12h20"></path>
	              <path d="M12 2c2.5 2.7 4 6.3 4 10s-1.5 7.3-4 10c-2.5-2.7-4-6.3-4-10s1.5-7.3 4-10z"></path>
	            </symbol>
	            <symbol id="i-play" viewBox="0 0 24 24">
	              <polygon points="8 5 19 12 8 19 8 5"></polygon>
	            </symbol>
	            <symbol id="i-stop" viewBox="0 0 24 24">
	              <rect x="7" y="7" width="10" height="10" rx="1"></rect>
	            </symbol>
	            <symbol id="i-refresh" viewBox="0 0 24 24">
	              <path d="M21 12a9 9 0 1 1-2.64-6.36"></path>
	              <polyline points="21 3 21 9 15 9"></polyline>
	            </symbol>
	            <symbol id="i-trash" viewBox="0 0 24 24">
	              <polyline points="3 6 5 6 21 6"></polyline>
	              <path d="M19 6l-1 14H6L5 6"></path>
	              <path d="M10 11v6"></path>
	              <path d="M14 11v6"></path>
	              <path d="M9 6V4h6v2"></path>
	            </symbol>
	            <symbol id="i-plus" viewBox="0 0 24 24">
	              <path d="M12 5v14"></path>
	              <path d="M5 12h14"></path>
	            </symbol>
	            <symbol id="i-edit" viewBox="0 0 24 24">
	              <path d="M12 20h9"></path>
	              <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L8 18l-4 1 1-4 11.5-11.5z"></path>
	            </symbol>
	            <symbol id="i-eye" viewBox="0 0 24 24">
	              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8"></path>
	              <circle cx="12" cy="12" r="3"></circle>
	            </symbol>
		            <symbol id="i-eye-off" viewBox="0 0 24 24">
		              <path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.81 21.81 0 0 1 5.06-6.06"></path>
		              <path d="M9.9 4.24A10.94 10.94 0 0 1 12 4c7 0 11 8 11 8a21.81 21.81 0 0 1-2.91 4.83"></path>
		              <path d="M1 1l22 22"></path>
		              <path d="M14.12 14.12a3 3 0 1 1-4.24-4.24"></path>
		            </symbol>
		            <symbol id="i-eye-closed" viewBox="0 0 24 24">
		              <path d="M2 12s4 5 10 5 10-5 10-5"></path>
		              <path d="M4 16l-1 2"></path>
		              <path d="M8 17l-.5 2"></path>
		              <path d="M12 17v2"></path>
		              <path d="M16 17l.5 2"></path>
		              <path d="M20 16l1 2"></path>
		            </symbol>
		            <symbol id="i-power" viewBox="0 0 24 24">
		              <path d="M12 2v10"></path>
		              <path d="M6.6 6.6a7 7 0 1 0 10.8 0"></path>
		            </symbol>
	            <symbol id="i-menu" viewBox="0 0 24 24">
	              <line x1="4" y1="7" x2="20" y2="7"></line>
	              <line x1="4" y1="12" x2="20" y2="12"></line>
	              <line x1="4" y1="17" x2="20" y2="17"></line>
	            </symbol>
	            <symbol id="i-arrow-up" viewBox="0 0 24 24">
	              <path d="M12 19V5"></path>
	              <polyline points="5 12 12 5 19 12"></polyline>
	            </symbol>
	            <symbol id="i-arrow-down" viewBox="0 0 24 24">
	              <path d="M12 5v14"></path>
	              <polyline points="19 12 12 19 5 12"></polyline>
	            </symbol>
	            <symbol id="i-download" viewBox="0 0 24 24">
	              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
	              <polyline points="7 10 12 15 17 10"></polyline>
	              <line x1="12" y1="15" x2="12" y2="3"></line>
	            </symbol>
	          </svg>
				    <div id="main">
		      <div class="row" id="topbar">
		        <div>
		          <div class="top-title">Codex Sidecar · 会话旁路监视</div>
		        </div>
		        <div class="meta status-text" id="statusText" tabindex="0" aria-label="状态">
		          <span id="statusMain"></span>
		          <div id="statusHover" class="status-hover" aria-hidden="true"></div>
		        </div>
		      </div>
			      <div id="list"></div>
			    </div>

										    										    <div id="rightbar" class="rightbar" aria-label="actions">
										      <button id="configToggleBtn" class="icon-btn" type="button" aria-label="设置"><svg class="ico" aria-hidden="true"><use href="#i-settings"></use></svg></button>
										      <button id="quickViewBtn" class="icon-btn" type="button" aria-label="精简显示"><svg class="ico" aria-hidden="true"><use href="#i-bolt"></use></svg></button>
										      <button id="translateToggleBtn" class="icon-btn" type="button" aria-label="翻译"><svg class="ico" aria-hidden="true"><use href="#i-globe"></use></svg></button>
										      <button id="watchToggleBtn" class="icon-btn" type="button" aria-label="开始监听"><svg class="ico" aria-hidden="true"><use href="#i-play"></use></svg></button>
										      <button id="clearBtn" class="icon-btn danger" type="button" aria-label="清空消息"><svg class="ico" aria-hidden="true"><use href="#i-trash"></use></svg></button>
										      <button id="powerBtn" class="icon-btn danger" type="button" aria-label="关闭/长按重启"><svg class="ico" aria-hidden="true"><use href="#i-power"></use></svg></button>
										    </div>
<div id="drawerOverlay" class="drawer-overlay hidden"></div>
					    <div id="drawer" class="drawer hidden" role="dialog" aria-modal="true" aria-label="设置">
					      <div class="drawer-head">
					        <div class="title">设置</div>
				        <button id="drawerCloseBtn" class="drawer-close" type="button" aria-label="关闭">×</button>
				      </div>
			      			      <div class="drawer-sec">
			        <div class="grid grid-compact">
				          <div class="meta">监视目录（固定）</div><div><input id="watchHome" readonly placeholder="~/.codex" /></div>
			          <div class="meta">自动开始</div><div><select id="autoStart"><option value="0">否</option><option value="1">是</option></select></div>
				          <div class="meta">提示音</div>
				          <div>
					            <select id="notifySound">
					              <option value="none">无</option>
					              <option value="soft-1-low">提示音-1（轻）</option>
					              <option value="soft-1">提示音-1（中）</option>
					              <option value="soft-1-high">提示音-1（强）</option>
					              <option value="soft-2-low">提示音-2（轻）</option>
					              <option value="soft-2">提示音-2（中）</option>
					              <option value="soft-2-high">提示音-2（强）</option>
					              <option value="soft-3-low">提示音-3（轻）</option>
					              <option value="soft-3">提示音-3（中）</option>
					              <option value="soft-3-high">提示音-3（强）</option>
					            </select>
					          </div>
					          <div class="meta">皮肤</div>
					          <div>
					            <select id="uiSkin">
					              <option value="default">默认</option>
					              <option value="soft">柔和</option>
					              <option value="contrast">对比</option>
					              <option value="flat">扁平</option>
					              <option value="dark">深色</option>
					            </select>
					          </div>
						          <div class="meta">字体大小</div>
						          <div>
						            <div class="unit-field">
						              <input id="uiFontSize" type="number" min="12" max="24" step="1" inputmode="numeric" placeholder="14" />
						              <span class="unit">px</span>
						            </div>
						          </div>
						          <div class="meta">按钮大小</div>
						          <div>
						            <div class="unit-field">
						              <input id="uiBtnSize" type="number" min="32" max="72" step="1" inputmode="numeric" placeholder="38" />
						              <span class="unit">px</span>
						            </div>
						          </div>
						          <div class="meta">并行会话</div><div><input id="maxSessions" type="number" min="1" step="1" /></div>
					          <div class="meta">回放行数</div><div><input id="replayLines" type="number" min="0" step="1" /></div>
						          <div class="meta">导出默认</div>
						          <div id="exportOptions" class="check-row">
						            <label class="check"><input id="exportQuick" type="checkbox" checked />精简模式</label>
						            <label class="check"><input id="exportTranslate" type="checkbox" checked />翻译</label>
						          </div>
					        </div>
				        <div class="meta" style="margin-top:6px;">
				          提示：提示音-1/2/3 为不同音色；轻/中/强为音量（选择后会播放预览）。
				        </div>

				        <details class="drawer-details">
				          <summary class="drawer-subtitle">高级选项</summary>
				          <div class="grid grid-compact">
					            <div class="meta">进程定位</div><div><select id="followProc"><option value="0">否</option><option value="1">是</option></select></div>
				            <div class="meta">仅在有进程时跟随</div><div><select id="onlyWhenProc"><option value="1">是</option><option value="0">否</option></select></div>
				            <div class="meta">进程匹配 regex</div><div><input id="procRegex" placeholder="codex" /></div>
				            <div class="meta">poll（秒）</div><div><input id="pollInterval" type="number" min="0.05" step="0.05" /></div>
				            <div class="meta">scan（秒）</div><div><input id="scanInterval" type="number" min="0.2" step="0.1" /></div>
				            <div class="meta">配置目录（只读）</div><div><input id="cfgHome" readonly /></div>
				          </div>
				          <div class="meta" style="margin-top:8px; line-height:1.6;">
				            说明：<br>
					            - 进程定位：优先跟随正在运行的 Codex 进程写入的会话文件（更“准”）<br>
				            - 仅在有进程时跟随：找不到进程就暂停跟随（避免误跟到历史会话）<br>
				            - poll：读文件/推送的轮询间隔；scan：扫描会话文件/进程的间隔（越小越实时但更耗 CPU/IO）
				          </div>
				        </details>

					        <div class="meta" style="margin-top:8px;">
						          提示：皮肤/提示音/自动翻译为即时生效；其余参数需点“保存”后生效。
					        </div>
					      </div>
		<div class="btns">
						        <button id="openTranslateFromSettingsBtn" type="button">翻译设置</button>
						        <button class="primary" id="saveBtn" type="button">保存</button>
						      </div>
						      <div id="configErrorText" class="meta form-error" style="margin-top:6px;"></div>
					      <details id="debugDetails" style="margin-top:8px;">
					        <summary class="meta">调试信息（配置加载/缓存排查）</summary>
					        <pre id="debugText" class="meta" style="white-space:pre-wrap; user-select:text;"></pre>
					      </details>
				    </div>
				    <div id="translateDrawerOverlay" class="drawer-overlay hidden"></div>
				    <div id="translateDrawer" class="drawer hidden" role="dialog" aria-modal="true" aria-label="翻译设置">
				      <div class="drawer-head">
				        <div class="title">翻译设置</div>
				        <button id="translateDrawerCloseBtn" class="drawer-close" type="button" aria-label="关闭">×</button>
				      </div>
				      <div class="drawer-sec">
				        <div class="grid grid-compact">
				          <div class="meta">自动翻译</div>
				          <div>
				            <select id="translateMode">
				              <option value="auto">开启（自动）</option>
				              <option value="manual">关闭（手动）</option>
				            </select>
				          </div>
				          <div class="meta">Provider</div><div><select id="translator"></select></div>
				        </div>
				        <div id="httpBlock" class="http-block">
				          <div class="grid grid-compact">
				            <div class="meta">Profiles</div>
				            <div class="profile-row">
					              <select id="httpProfile" style="flex:1;"></select>
						              <button id="httpProfileAddBtn" class="mini-btn" type="button" aria-label="新增"><svg class="ico" aria-hidden="true"><use href="#i-plus"></use></svg></button>
						              <button id="httpProfileRenameBtn" class="mini-btn" type="button" aria-label="重命名"><svg class="ico" aria-hidden="true"><use href="#i-edit"></use></svg></button>
						              <button id="httpProfileDelBtn" class="mini-btn danger" type="button" aria-label="删除"><svg class="ico" aria-hidden="true"><use href="#i-trash"></use></svg></button>
					            </div>
				            <div class="meta">URL</div><div><input id="httpUrl" placeholder="https://api.deeplx.org/{token}/translate 或 http://127.0.0.1:9000/translate" /></div>
				            <div class="meta">Token</div>
				            <div>
				              <div class="profile-row">
				                <input id="httpToken" type="password" autocomplete="off" placeholder="可用于 Authorization 或替换 URL 中的 {token}" style="flex:1;" />
				                <button id="httpTokenEyeBtn" class="mini-btn" type="button" aria-label="显示 Token">
				                  <svg class="ico" aria-hidden="true"><use href="#i-eye"></use></svg>
				                </button>
				              </div>
				            </div>
				            <div class="meta">超时（秒）</div><div><input id="httpTimeout" type="number" min="0.5" step="0.5" /></div>
				          </div>
				        </div>
				        <div id="nvidiaBlock" class="http-block">
				          <div class="grid grid-compact">
				            <div class="meta">Base URL</div><div><input id="nvidiaBaseUrl" placeholder="https://integrate.api.nvidia.com/v1" /></div>
				            <div class="meta">Model</div>
				            <div>
				              <div style="display:flex; gap:6px; align-items:center;">
						                <select id="nvidiaModel" style="flex:1;">
						                  <option value="moonshotai/kimi-k2-instruct">moonshotai/kimi-k2-instruct</option>
						                  <option value="google/gemma-3-1b-it">google/gemma-3-1b-it</option>
						                  <option value="mistralai/mistral-7b-instruct-v0.3">mistralai/mistral-7b-instruct-v0.3</option>
						                  <option value="mistralai/ministral-14b-instruct-2512">mistralai/ministral-14b-instruct-2512</option>
						                </select>
				              </div>
				            </div>
				            <div class="meta">API Key</div>
				            <div>
				              <div class="profile-row">
				                <input id="nvidiaApiKey" type="password" autocomplete="off" placeholder="nvapi-..." style="flex:1;" />
				                <button id="nvidiaApiKeyEyeBtn" class="mini-btn" type="button" aria-label="显示 API Key">
				                  <svg class="ico" aria-hidden="true"><use href="#i-eye"></use></svg>
				                </button>
				              </div>
				            </div>
				            <div class="meta"></div>
				            <div class="meta">
				              API Key 获取方式：<br>
				              <a class="meta-link" href="https://build.nvidia.com/settings/api-keys" target="_blank" rel="noopener">https://build.nvidia.com/settings/api-keys</a>
				            </div>
				            <div class="meta">Max Tokens（固定）</div><div class="meta" id="nvidiaMaxTokensText">8192</div>
				            <div class="meta">RPM（0 为关闭）</div><div><input id="nvidiaRpm" type="number" min="0" step="1" /></div>
				            <div class="meta">超时（秒）</div><div><input id="nvidiaTimeout" type="number" min="0.5" step="0.5" /></div>
				          </div>
				        </div>
				        <div id="openaiBlock" class="http-block">
				          <div class="grid grid-compact">
				            <div class="meta">Base URL</div>
				            <div>
				              <div class="profile-row">
				                <input id="openaiBaseUrl" type="password" autocomplete="off" placeholder="https://…（或…/responses）" style="flex:1;" />
				                <button id="openaiBaseUrlEyeBtn" class="mini-btn" type="button" aria-label="显示 Base URL">
				                  <svg class="ico" aria-hidden="true"><use href="#i-eye"></use></svg>
				                </button>
				              </div>
				            </div>
				            <div class="meta">Model</div><div><input id="openaiModel" placeholder="gpt-5.1" /></div>
				            <div class="meta">API Key</div>
				            <div>
				              <div class="profile-row">
				                <input id="openaiApiKey" type="password" autocomplete="off" placeholder="sk-..." style="flex:1;" />
				                <button id="openaiApiKeyEyeBtn" class="mini-btn" type="button" aria-label="显示 API Key">
				                  <svg class="ico" aria-hidden="true"><use href="#i-eye"></use></svg>
				                </button>
				              </div>
				            </div>
				            <div class="meta">鉴权方式</div>
				            <div>
					              <select id="openaiAuthMode">
					                <option value="authorization">Authorization: Bearer</option>
					                <option value="x-api-key">x-api-key</option>
					              </select>
				            </div>
				            <div class="meta">Reasoning</div>
				            <div>
				              <select id="openaiReasoning">
				                <option value="">不启用/自动</option>
				                <option value="none">none</option>
				                <option value="minimal">minimal</option>
				                <option value="low">low</option>
				                <option value="medium">medium</option>
				                <option value="high">high</option>
				              </select>
				            </div>
				            <div class="meta">超时（秒）</div><div><input id="openaiTimeout" type="number" min="0.5" step="0.5" /></div>
				          </div>
				          <div class="meta" style="margin-top:6px;">
				            提示：某些 Codex 网关会忽略 system prompt；sidecar 已把翻译指令放在 user 内容里以增强兼容性。
				          </div>
				        </div>
					        <div class="btns" style="margin-top:10px;">
					          <button class="primary" id="saveTranslateBtn" type="button">保存</button>
					        </div>
					        <div id="translateErrorText" class="meta form-error" style="margin-top:6px;"></div>
					      </div>
						    </div>
					    <div id="bookmarkDrawerOverlay" class="drawer-overlay hidden"></div>
						    <div id="bookmarkDrawer" class="drawer hidden" role="dialog" aria-modal="true" aria-label="会话管理">
						      <div class="drawer-head">
						        <div class="title">会话管理</div>
						        <button id="bookmarkDrawerCloseBtn" class="drawer-close" type="button" aria-label="关闭">×</button>
							      </div>
							      <div class="drawer-sec">
							        <div id="bookmarkList" class="tabs" style="margin-top:10px;"></div>
							        <details id="bookmarkHiddenDetails" class="drawer-details" style="margin-top:10px;">
							          <summary class="meta">已关闭监听 <span id="bookmarkHiddenCount" class="pill">0</span></summary>
							          <div id="bookmarkHiddenList" class="tabs" style="margin-top:10px;"></div>
							        </details>
						      </div>
						    </div>
							    <dialog id="confirmDialog" class="confirm-dialog" role="alertdialog" aria-labelledby="confirmDialogTitle" aria-describedby="confirmDialogDesc">
							      <form method="dialog" class="confirm-dialog-form">
							        <div class="confirm-dialog-title" id="confirmDialogTitle">确认操作</div>
							        <div class="confirm-dialog-desc meta" id="confirmDialogDesc"></div>
						        <div class="btns" style="margin-top:12px; justify-content:flex-end;">
						          <button id="confirmDialogCancel" value="cancel" type="submit" autofocus>取消</button>
						          <button id="confirmDialogOk" value="confirm" type="submit" class="danger">确认</button>
						        </div>
						      </form>
						    </dialog>
						    <div class="float-nav" aria-label="scroll">
						      <button id="scrollTopBtn" type="button" aria-label="回到页面顶部"><svg class="ico" aria-hidden="true"><use href="#i-arrow-up"></use></svg></button>
						      <button id="scrollBottomBtn" type="button" aria-label="回到页面底部"><svg class="ico" aria-hidden="true"><use href="#i-arrow-down"></use></svg></button>
						      <button id="bookmarkDrawerToggleBtn" class="bm-menu-btn" type="button" aria-label="会话列表"><svg class="ico" aria-hidden="true"><use href="#i-menu"></use></svg></button>
						    </div>
		    <script defer src="/ui/vendor/katex/katex.min.js"></script>
		    <script defer src="/ui/vendor/katex/auto-render.min.js"></script>
		    <script type="module" src="/ui/app.js"></script>
	  </body>
	</html>
