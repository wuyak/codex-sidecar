<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Codex Thinking Sidecar</title>
    <link rel="stylesheet" href="/ui/styles.css" />
		  </head>
		  <body>
	    <div id="sidebar">
	      <div class="sidebar-head">
	        <div class="meta"><b>会话切换</b></div>
	        <button id="sidebarToggleBtn" class="sidebar-toggle" type="button" title="折叠/展开">⟪</button>
	      </div>
	      <div id="tabs" class="tabs"></div>
	    </div>
	    <div id="main">
	      <div class="row" id="topbar">
	        <div style="display:flex; align-items:flex-start; gap:12px; flex-wrap:wrap;">
	          <div style="flex:1; min-width: 280px;">
	            <div style="font-size:18px; font-weight:700;">Codex Thinking Sidecar（旁路思考摘要）</div>
	            <div class="meta">实时订阅：<code>/events</code>（SSE），最近数据：<code>/api/messages</code>，会话列表：<code>/api/threads</code></div>
	          </div>
	          <div class="btns" style="margin-top:0;">
	            <button id="configToggleBtn" type="button">配置</button>
	            <button class="primary" id="startBtn" type="button">开始监听</button>
	            <button id="stopBtn" type="button">停止监听</button>
	            <button class="danger" id="clearBtn" type="button">清空显示</button>
	          </div>
	        </div>
	        <div class="meta" id="statusText"></div>
	      </div>
		      <div id="list"></div>
		    </div>
		    <div id="drawerOverlay" class="drawer-overlay hidden"></div>
		    <div id="drawer" class="drawer hidden" role="dialog" aria-modal="true" aria-label="配置">
		      <div class="drawer-head">
		        <div class="title">配置</div>
		        <button id="drawerCloseBtn" class="drawer-close" type="button" title="关闭">×</button>
		      </div>
		      <div class="grid" style="margin-top: 10px;">
		        <div class="meta">配置目录（只读）</div><div><input id="cfgHome" readonly /></div>
		        <div class="meta">监视目录（CODEX_HOME）</div><div><input id="watchHome" placeholder="/home/kino/.codex 或 /mnt/c/Users/.../.codex" /></div>
		        <div class="meta">自动开始监听（UI）</div><div><select id="autoStart"><option value="0">否</option><option value="1">是</option></select></div>
		        <div class="meta">基于 Codex 进程定位</div><div><select id="followProc"><option value="0">否</option><option value="1">是</option></select></div>
		        <div class="meta">仅在检测到进程时跟随</div><div><select id="onlyWhenProc"><option value="1">是</option><option value="0">否</option></select></div>
		        <div class="meta">Codex 进程匹配（regex）</div><div><input id="procRegex" placeholder="codex" /></div>
		        <div class="meta">回放行数</div><div><input id="replayLines" type="number" min="0" step="1" /></div>
		        <div class="meta">采集 agent_reasoning</div><div><select id="includeAgent"><option value="0">否</option><option value="1">是</option></select></div>
		        <div class="meta">显示模式</div><div><select id="displayMode"><option value="both">中英文对照</option><option value="zh">仅中文</option><option value="en">仅英文</option></select></div>
		        <div class="meta">poll_interval（秒）</div><div><input id="pollInterval" type="number" min="0.05" step="0.05" /></div>
		        <div class="meta">file_scan_interval（秒）</div><div><input id="scanInterval" type="number" min="0.2" step="0.1" /></div>
		        <div class="meta">翻译 Provider</div><div><select id="translator"></select></div>
		        <div class="meta">HTTP Profiles</div><div style="display:flex; gap:8px; align-items:center;"><select id="httpProfile" style="flex:1;"></select><button id="httpProfileAddBtn" type="button">新增</button><button id="httpProfileRenameBtn" type="button">重命名</button><button id="httpProfileDelBtn" type="button">删除</button></div>
		        <div class="meta">HTTP URL（仅 http/https）</div><div><input id="httpUrl" placeholder="https://api.deeplx.org/{token}/translate 或 http://127.0.0.1:9000/translate" /></div>
		        <div class="meta">HTTP Token（可选）</div><div><input id="httpToken" placeholder="可用于 Authorization 或替换 URL 中的 {token}" /></div>
		        <div class="meta">HTTP 超时（秒）</div><div><input id="httpTimeout" type="number" min="0.5" step="0.5" /></div>
		        <div class="meta">Auth ENV（可选）</div><div><input id="httpAuthEnv" placeholder="CODEX_TRANSLATE_TOKEN" /></div>
		      </div>
		      <div class="btns">
		        <button class="primary" id="saveBtn" type="button">保存配置</button>
		        <button id="recoverBtn" type="button">恢复配置</button>
		        <button class="danger" id="shutdownBtn" type="button">退出 Sidecar</button>
		      </div>
		      <details id="debugDetails" style="margin-top:8px;">
		        <summary class="meta">调试信息（配置加载/缓存排查）</summary>
		        <pre id="debugText" class="meta" style="white-space:pre-wrap; user-select:text;"></pre>
		      </details>
		    </div>
		    <div class="float-nav" aria-label="scroll">
		      <button id="scrollTopBtn" type="button" title="回到页面顶部">↑ 顶部</button>
		      <button id="scrollBottomBtn" type="button" title="回到页面底部">↓ 底部</button>
		    </div>
	    <script src="/ui/app.js" defer></script>
  </body>
</html>
