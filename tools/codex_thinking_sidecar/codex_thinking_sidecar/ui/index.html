<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Codex Sidecar · 会话旁路监视</title>
    <link rel="stylesheet" href="/ui/styles.css" />
		  </head>
				  <body data-bm-skin="default">
	          <div id="bookmarks" class="bookmarks" aria-label="会话书签"></div>
	          <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute; width:0; height:0; overflow:hidden" aria-hidden="true" focusable="false">
	            <symbol id="i-settings" viewBox="0 0 24 24">
	              <path d="M12 15.5a3.5 3.5 0 1 0 0-7a3.5 3.5 0 0 0 0 7z"></path>
	              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33a1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.6a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
	            </symbol>
	            <symbol id="i-bolt" viewBox="0 0 24 24">
	              <path d="M13 2L3 14h7l-1 8 10-12h-7z"></path>
	            </symbol>
	            <symbol id="i-globe" viewBox="0 0 24 24">
	              <circle cx="12" cy="12" r="10"></circle>
	              <path d="M2 12h20"></path>
	              <path d="M12 2c2.5 2.7 4 6.3 4 10s-1.5 7.3-4 10c-2.5-2.7-4-6.3-4-10s1.5-7.3 4-10z"></path>
	            </symbol>
	            <symbol id="i-play" viewBox="0 0 24 24">
	              <polygon points="8 5 19 12 8 19 8 5"></polygon>
	            </symbol>
	            <symbol id="i-stop" viewBox="0 0 24 24">
	              <rect x="7" y="7" width="10" height="10" rx="1"></rect>
	            </symbol>
	            <symbol id="i-refresh" viewBox="0 0 24 24">
	              <path d="M21 12a9 9 0 1 1-2.64-6.36"></path>
	              <polyline points="21 3 21 9 15 9"></polyline>
	            </symbol>
	            <symbol id="i-trash" viewBox="0 0 24 24">
	              <polyline points="3 6 5 6 21 6"></polyline>
	              <path d="M19 6l-1 14H6L5 6"></path>
	              <path d="M10 11v6"></path>
	              <path d="M14 11v6"></path>
	              <path d="M9 6V4h6v2"></path>
	            </symbol>
	            <symbol id="i-power" viewBox="0 0 24 24">
	              <path d="M12 2v10"></path>
	              <path d="M6.6 6.6a7 7 0 1 0 10.8 0"></path>
	            </symbol>
	            <symbol id="i-arrow-up" viewBox="0 0 24 24">
	              <path d="M12 19V5"></path>
	              <polyline points="5 12 12 5 19 12"></polyline>
	            </symbol>
	            <symbol id="i-arrow-down" viewBox="0 0 24 24">
	              <path d="M12 5v14"></path>
	              <polyline points="19 12 12 19 5 12"></polyline>
	            </symbol>
	          </svg>
				    <div id="main">
		      <div class="row" id="topbar">
		        <div>
		          <div class="top-title">Codex Sidecar · 会话旁路监视</div>
		          <div class="meta">订阅：<code>/events</code>（SSE） · 数据：<a class="meta-link" href="/api/messages" target="_blank" rel="noopener">/api/messages</a> · 会话：<a class="meta-link" href="/api/threads" target="_blank" rel="noopener">/api/threads</a></div>
		        </div>
		        <div class="meta" id="statusText"></div>
		      </div>
			      <div id="list"></div>
			    </div>

							    <div id="rightbar" class="rightbar" aria-label="actions">
							      <button id="configToggleBtn" class="icon-btn" type="button" aria-label="配置"><svg class="ico" aria-hidden="true"><use href="#i-settings"></use></svg></button>
								      <button id="quickViewBtn" class="icon-btn" type="button" aria-label="快速浏览"><svg class="ico" aria-hidden="true"><use href="#i-bolt"></use></svg></button>
							      <button id="translateToggleBtn" class="icon-btn" type="button" aria-label="自动翻译"><svg class="ico" aria-hidden="true"><use href="#i-globe"></use></svg></button>
							      <button id="startBtn" class="icon-btn" type="button" aria-label="开始监听"><svg class="ico" aria-hidden="true"><use href="#i-play"></use></svg></button>
						      <button id="stopBtn" class="icon-btn" type="button" aria-label="停止监听"><svg class="ico" aria-hidden="true"><use href="#i-stop"></use></svg></button>
						      <button id="restartBtn" class="icon-btn" type="button" aria-label="重启 Sidecar"><svg class="ico" aria-hidden="true"><use href="#i-refresh"></use></svg></button>
						      <button id="clearBtn" class="icon-btn danger" type="button" aria-label="清空显示"><svg class="ico" aria-hidden="true"><use href="#i-trash"></use></svg></button>
						      <button id="shutdownBtn" class="icon-btn danger" type="button" aria-label="退出 Sidecar"><svg class="ico" aria-hidden="true"><use href="#i-power"></use></svg></button>
					    </div>
				    <div id="drawerOverlay" class="drawer-overlay hidden"></div>
				    <div id="drawer" class="drawer hidden" role="dialog" aria-modal="true" aria-label="配置">
				      <div class="drawer-head">
				        <div class="title">配置</div>
				        <button id="drawerCloseBtn" class="drawer-close" type="button" aria-label="关闭">×</button>
				      </div>
			      <div class="drawer-sec">
			        <div class="grid grid-compact">
			          <div class="meta">监视目录</div><div><input id="watchHome" placeholder="/home/kino/.codex 或 /mnt/c/Users/.../.codex" /></div>
			          <div class="meta">自动开始</div><div><select id="autoStart"><option value="0">否</option><option value="1">是</option></select></div>
			          <div class="meta">提示音</div>
			          <div>
			            <select id="notifySound">
			              <option value="none">无</option>
			              <option value="soft-1">舒缓-1</option>
			              <option value="soft-2">舒缓-2</option>
			              <option value="soft-3">舒缓-3</option>
			            </select>
			          </div>
			          <div class="meta">并行会话</div><div><input id="maxSessions" type="number" min="1" step="1" /></div>
			          <div class="meta">回放行数</div><div><input id="replayLines" type="number" min="0" step="1" /></div>
			          <div class="meta">采集 agent_reasoning</div><div><select id="includeAgent"><option value="0">否</option><option value="1">是</option></select></div>
			          <div class="meta">进程定位</div><div><select id="followProc"><option value="0">否</option><option value="1">是</option></select></div>
			          <div class="meta">仅在有进程时跟随</div><div><select id="onlyWhenProc"><option value="1">是</option><option value="0">否</option></select></div>
			          <div class="meta">进程匹配 regex</div><div><input id="procRegex" placeholder="codex" /></div>
			          <div class="meta">poll（秒）</div><div><input id="pollInterval" type="number" min="0.05" step="0.05" /></div>
			          <div class="meta">scan（秒）</div><div><input id="scanInterval" type="number" min="0.2" step="0.1" /></div>
			          <div class="meta">配置目录</div><div><input id="cfgHome" readonly /></div>
			        </div>
			        <div class="meta" style="margin-top:8px;">
			          提示：保存后大多数参数会立即生效；如你修改了“监视目录”，需停止后再开始监听才会切换到新目录。
			        </div>
			      </div>
				      <div class="btns">
				        <button class="primary" id="saveBtn" type="button">保存</button>
				      </div>
				      <details id="debugDetails" style="margin-top:8px;">
				        <summary class="meta">调试信息（配置加载/缓存排查）</summary>
				        <pre id="debugText" class="meta" style="white-space:pre-wrap; user-select:text;"></pre>
				      </details>
				    </div>
				    <div id="translateDrawerOverlay" class="drawer-overlay hidden"></div>
				    <div id="translateDrawer" class="drawer hidden" role="dialog" aria-modal="true" aria-label="翻译设置">
				      <div class="drawer-head">
				        <div class="title">翻译设置</div>
				        <button id="translateDrawerCloseBtn" class="drawer-close" type="button" aria-label="关闭">×</button>
				      </div>
				      <div class="drawer-sec">
				        <div class="grid grid-compact">
				          <div class="meta">自动翻译</div>
				          <div>
				            <select id="translateMode">
				              <option value="auto">开启（自动）</option>
				              <option value="manual">关闭（手动）</option>
				            </select>
				          </div>
				          <div class="meta">Provider</div><div><select id="translator"></select></div>
				        </div>
				        <div id="httpBlock" class="http-block">
				          <div class="grid grid-compact">
				            <div class="meta">Profiles</div>
				            <div class="profile-row">
					              <select id="httpProfile" style="flex:1;"></select>
					              <button id="httpProfileAddBtn" class="mini-btn" type="button" aria-label="新增">＋</button>
					              <button id="httpProfileRenameBtn" class="mini-btn" type="button" aria-label="重命名">✎</button>
					              <button id="httpProfileDelBtn" class="mini-btn danger" type="button" aria-label="删除">🗑</button>
					            </div>
				            <div class="meta">URL</div><div><input id="httpUrl" placeholder="https://api.deeplx.org/{token}/translate 或 http://127.0.0.1:9000/translate" /></div>
				            <div class="meta">Token</div><div><input id="httpToken" type="password" placeholder="可用于 Authorization 或替换 URL 中的 {token}" /></div>
				            <div class="meta">超时（秒）</div><div><input id="httpTimeout" type="number" min="0.5" step="0.5" /></div>
				          </div>
				        </div>
				        <div id="nvidiaBlock" class="http-block">
				          <div class="grid grid-compact">
				            <div class="meta">Base URL</div><div><input id="nvidiaBaseUrl" placeholder="https://integrate.api.nvidia.com/v1" /></div>
				            <div class="meta">Model</div>
				            <div>
				              <div style="display:flex; gap:6px; align-items:center;">
					                <select id="nvidiaModel" style="flex:1;">
					                  <option value="">（选择模型…）</option>
					                  <option value="moonshotai/kimi-k2-instruct">moonshotai/kimi-k2-instruct</option>
					                  <option value="google/gemma-3-1b-it">google/gemma-3-1b-it</option>
					                  <option value="mistralai/mistral-7b-instruct-v0.3">mistralai/mistral-7b-instruct-v0.3</option>
					                  <option value="mistralai/ministral-14b-instruct-2512">mistralai/ministral-14b-instruct-2512</option>
					                </select>
				              </div>
				            </div>
				            <div class="meta">API Key</div><div><input id="nvidiaApiKey" type="password" autocomplete="off" placeholder="nvapi-..." /></div>
				            <div class="meta">Max Tokens</div><div><input id="nvidiaMaxTokens" type="number" min="0" step="1" /></div>
				            <div class="meta">RPM（节流，0=关闭）</div><div><input id="nvidiaRpm" type="number" min="0" step="1" /></div>
				            <div class="meta">超时（秒）</div><div><input id="nvidiaTimeout" type="number" min="0.5" step="0.5" /></div>
				          </div>
				        </div>
				        <div id="openaiBlock" class="http-block">
				          <div class="grid grid-compact">
				            <div class="meta">Base URL</div><div><input id="openaiBaseUrl" placeholder="https://www.right.codes/codex/v1（或…/responses）" /></div>
				            <div class="meta">Model</div><div><input id="openaiModel" placeholder="gpt-5.1" /></div>
				            <div class="meta">API Key</div><div><input id="openaiApiKey" type="password" autocomplete="off" placeholder="sk-..." /></div>
				            <div class="meta">鉴权方式</div>
				            <div>
					              <select id="openaiAuthMode">
					                <option value="authorization">Authorization: Bearer</option>
					                <option value="x-api-key">x-api-key</option>
					              </select>
				            </div>
				            <div class="meta">Reasoning</div>
				            <div>
				              <select id="openaiReasoning">
				                <option value="">不启用/自动</option>
				                <option value="none">none</option>
				                <option value="minimal">minimal</option>
				                <option value="low">low</option>
				                <option value="medium">medium</option>
				                <option value="high">high</option>
				              </select>
				            </div>
				            <div class="meta">超时（秒）</div><div><input id="openaiTimeout" type="number" min="0.5" step="0.5" /></div>
				          </div>
				          <div class="meta" style="margin-top:6px;">
				            提示：某些 Codex 网关会忽略 system prompt；sidecar 已把翻译指令放在 user 内容里以增强兼容性。
				          </div>
				        </div>
				        <div class="btns" style="margin-top:10px;">
				          <button class="primary" id="saveTranslateBtn" type="button">保存翻译设置（热加载）</button>
				          <button id="recoverBtn" type="button">恢复</button>
				        </div>
				      </div>
					    </div>
						    <div class="float-nav" aria-label="scroll">
						      <button id="scrollTopBtn" type="button" aria-label="回到页面顶部"><svg class="ico" aria-hidden="true"><use href="#i-arrow-up"></use></svg></button>
						      <button id="scrollBottomBtn" type="button" aria-label="回到页面底部"><svg class="ico" aria-hidden="true"><use href="#i-arrow-down"></use></svg></button>
						    </div>
		    <script type="module" src="/ui/app.js"></script>
	  </body>
	</html>
