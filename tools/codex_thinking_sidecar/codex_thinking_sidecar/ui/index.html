<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Codex Sidecar · 会话旁路监视</title>
    <link rel="stylesheet" href="/ui/styles.css" />
		  </head>
			  <body class="sidebar-auto">
          <div id="sidebarHotzone" aria-hidden="true"></div>
		    <div id="sidebar">
		      <div class="sidebar-head">
		        <div class="meta"><b>会话切换</b></div>
		        <div class="sidebar-actions">
		          <button id="exportThreadBtn" class="mini-btn" type="button" title="导出当前会话（Markdown）">⤓</button>
		          <button id="hideThreadBtn" class="mini-btn" type="button" title="隐藏/取消隐藏当前会话">🙈</button>
		          <button id="showHiddenBtn" class="mini-btn" type="button" title="显示隐藏会话">👁</button>
		          <label class="meta pin-toggle" title="开启后：点击会话会锁定跟随（不会自动跳到新会话）；关闭后：只切换视图，不影响 watcher 跟随策略">
		            <input id="pinOnSelect" type="checkbox" />
		            <span>锁定</span>
		          </label>
		        </div>
		      </div>
		      <div id="tabs" class="tabs"></div>
		    </div>
			    <div id="main">
		      <div class="row" id="topbar">
		        <div>
		          <div class="top-title">Codex Sidecar · 会话旁路监视</div>
		          <div class="meta">订阅：<code>/events</code>（SSE） · 数据：<a class="meta-link" href="/api/messages" target="_blank" rel="noopener">/api/messages</a> · 会话：<a class="meta-link" href="/api/threads" target="_blank" rel="noopener">/api/threads</a></div>
		        </div>
		        <div class="meta" id="statusText"></div>
		      </div>
			      <div id="list"></div>
			    </div>

					    <div id="rightbar" class="rightbar" aria-label="actions">
					      <button id="configToggleBtn" class="icon-btn" type="button" title="配置" aria-label="配置">⚙️</button>
					      <button id="quickViewBtn" class="icon-btn" type="button" title="快速浏览（仅输入/输出/思考）" aria-label="快速浏览">⚡</button>
					      <button id="translateToggleBtn" class="icon-btn" type="button" title="自动翻译" aria-label="自动翻译">🌐</button>
					      <button id="startBtn" class="icon-btn" type="button" title="开始监听" aria-label="开始监听">▶️</button>
				      <button id="stopBtn" class="icon-btn" type="button" title="停止监听" aria-label="停止监听">⏹️</button>
				      <button id="restartBtn" class="icon-btn" type="button" title="重启 Sidecar" aria-label="重启 Sidecar">🔄</button>
				      <button id="clearBtn" class="icon-btn danger" type="button" title="清空显示" aria-label="清空显示">🧹</button>
				      <button id="shutdownBtn" class="icon-btn danger" type="button" title="退出 Sidecar" aria-label="退出 Sidecar">⏻</button>
			    </div>
			    <div id="drawerOverlay" class="drawer-overlay hidden"></div>
			    <div id="drawer" class="drawer hidden" role="dialog" aria-modal="true" aria-label="配置">
			      <div class="drawer-head">
			        <div class="title">配置</div>
			        <button id="drawerCloseBtn" class="drawer-close" type="button" title="关闭">×</button>
			      </div>
			      <details class="drawer-sec" open>
			        <summary>基础</summary>
			        <div class="grid grid-compact">
			          <div class="meta">监视目录</div><div><input id="watchHome" placeholder="/home/kino/.codex 或 /mnt/c/Users/.../.codex" /></div>
			        </div>
			      </details>
				      <details class="drawer-sec" open>
				        <summary>翻译</summary>
				        <div class="grid grid-compact">
				          <div class="meta">Provider</div><div><select id="translator"></select></div>
				        </div>
					        <div id="httpBlock" class="http-block">
					          <div class="grid grid-compact">
				            <div class="meta">Profiles</div>
			            <div class="profile-row">
			              <select id="httpProfile" style="flex:1;"></select>
			              <button id="httpProfileAddBtn" class="mini-btn" type="button" title="新增">＋</button>
			              <button id="httpProfileRenameBtn" class="mini-btn" type="button" title="重命名">✎</button>
			              <button id="httpProfileDelBtn" class="mini-btn danger" type="button" title="删除">🗑</button>
			            </div>
			            <div class="meta">URL</div><div><input id="httpUrl" placeholder="https://api.deeplx.org/{token}/translate 或 http://127.0.0.1:9000/translate" /></div>
			            <div class="meta">Token</div><div><input id="httpToken" placeholder="可用于 Authorization 或替换 URL 中的 {token}" /></div>
			            <div class="meta">超时（秒）</div><div><input id="httpTimeout" type="number" min="0.5" step="0.5" /></div>
			            <div class="meta">Auth ENV</div><div><input id="httpAuthEnv" placeholder="CODEX_TRANSLATE_TOKEN" /></div>
					          </div>
					        </div>
					        <div id="nvidiaBlock" class="http-block">
					          <div class="grid grid-compact">
					            <div class="meta">Base URL</div><div><input id="nvidiaBaseUrl" placeholder="https://integrate.api.nvidia.com/v1" /></div>
					            <div class="meta">Model</div><div><input id="nvidiaModel" placeholder="nvidia/riva-translate-4b-instruct-v1_1" /></div>
					            <div class="meta">API Key</div><div><input id="nvidiaApiKey" placeholder="可留空并使用 Auth ENV" /></div>
					            <div class="meta">Auth ENV</div><div><input id="nvidiaAuthEnv" placeholder="NVIDIA_API_KEY" /></div>
					            <div class="meta">RPM</div><div><input id="nvidiaRpm" type="number" min="0" step="1" /></div>
					            <div class="meta">超时（秒）</div><div><input id="nvidiaTimeout" type="number" min="0.5" step="0.5" /></div>
					          </div>
					          <div class="meta" style="margin-top:6px;">
					            提示：建议仅用环境变量提供密钥（如 `NVIDIA_API_KEY`），避免写入本机配置文件。
					          </div>
					        </div>
					        <div id="openaiBlock" class="http-block">
					          <div class="grid grid-compact">
					            <div class="meta">Base URL</div><div><input id="openaiBaseUrl" placeholder="https://www.right.codes/codex/v1（或…/responses）" /></div>
				            <div class="meta">Model</div><div><input id="openaiModel" placeholder="gpt-4.1-mini / gpt-4o-mini / gpt-5.2 ..." /></div>
				            <div class="meta">API Key</div><div><input id="openaiApiKey" placeholder="sk-...（可留空并使用 Auth ENV）" /></div>
				            <div class="meta">Auth Header</div>
				            <div>
				              <select id="openaiAuthMode">
				                <option value="authorization">Authorization: Bearer</option>
				                <option value="x-api-key">x-api-key</option>
				              </select>
				            </div>
				            <div class="meta">Auth ENV</div><div><input id="openaiAuthEnv" placeholder="CODEX_TRANSLATE_TOKEN" /></div>
				            <div class="meta">Reasoning</div>
				            <div>
				              <select id="openaiReasoning">
				                <option value="">不启用/自动</option>
				                <option value="none">none</option>
				                <option value="minimal">minimal</option>
				                <option value="low">low</option>
				                <option value="medium">medium</option>
				                <option value="high">high</option>
				              </select>
				            </div>
				            <div class="meta">超时（秒）</div><div><input id="openaiTimeout" type="number" min="0.5" step="0.5" /></div>
				          </div>
				          <div class="meta" style="margin-top:6px;">
				            提示：某些 Codex 网关会忽略 system prompt；sidecar 已把翻译指令放在 user 内容里以增强兼容性。
				          </div>
				        </div>
				      </details>
			      <details class="drawer-sec">
			        <summary>高级</summary>
			        <div class="grid grid-compact">
				          <div class="meta">自动开始</div><div><select id="autoStart"><option value="0">否</option><option value="1">是</option></select></div>
				          <div class="meta">翻译模式</div><div><select id="translateMode"><option value="auto">自动翻译</option><option value="manual">手动翻译</option></select></div>
				          <div class="meta">提示音</div>
				          <div>
				            <select id="notifySound">
				              <option value="none">无</option>
				              <option value="soft-1">舒缓-1</option>
				              <option value="soft-2">舒缓-2</option>
				              <option value="soft-3">舒缓-3</option>
				            </select>
				          </div>
				          <div class="meta">并行会话</div><div><input id="maxSessions" type="number" min="1" step="1" /></div>
				          <div class="meta">回放行数</div><div><input id="replayLines" type="number" min="0" step="1" /></div>
				          <div class="meta">采集 reasoning</div><div><select id="includeAgent"><option value="0">否</option><option value="1">是</option></select></div>
				          <div class="meta">进程定位</div><div><select id="followProc"><option value="0">否</option><option value="1">是</option></select></div>
				          <div class="meta">仅跟随进程</div><div><select id="onlyWhenProc"><option value="1">是</option><option value="0">否</option></select></div>
			          <div class="meta">进程 regex</div><div><input id="procRegex" placeholder="codex" /></div>
			          <div class="meta">poll（秒）</div><div><input id="pollInterval" type="number" min="0.05" step="0.05" /></div>
			          <div class="meta">scan（秒）</div><div><input id="scanInterval" type="number" min="0.2" step="0.1" /></div>
			          <div class="meta">配置目录</div><div><input id="cfgHome" readonly /></div>
			        </div>
			      </details>
			      <div class="btns">
			        <button class="primary" id="saveBtn" type="button">保存</button>
			        <button id="recoverBtn" type="button">恢复</button>
			      </div>
			      <details id="debugDetails" style="margin-top:8px;">
			        <summary class="meta">调试信息（配置加载/缓存排查）</summary>
			        <pre id="debugText" class="meta" style="white-space:pre-wrap; user-select:text;"></pre>
			      </details>
			    </div>
			    <div class="float-nav" aria-label="scroll">
			      <button id="scrollTopBtn" type="button" title="回到页面顶部">↑</button>
			      <button id="scrollBottomBtn" type="button" title="回到页面底部">↓</button>
			    </div>
	    <script type="module" src="/ui/app.js"></script>
  </body>
</html>
