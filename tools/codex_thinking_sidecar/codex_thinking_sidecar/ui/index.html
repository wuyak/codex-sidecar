<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Codex Sidecar · 会话旁路监视</title>
    <link rel="stylesheet" href="/ui/styles.css" />
		  </head>
		  <body>
	    <div id="sidebar">
	      <div class="sidebar-head">
	        <div class="meta"><b>会话切换</b></div>
	        <button id="sidebarToggleBtn" class="sidebar-toggle" type="button" title="折叠/展开">⟪</button>
	      </div>
	      <div id="tabs" class="tabs"></div>
	    </div>
		    <div id="main">
		      <div class="row" id="topbar">
		        <div>
		          <div class="top-title">Codex Sidecar · 会话旁路监视</div>
		          <div class="meta">订阅：<code>/events</code>（SSE） · 数据：<a class="meta-link" href="/api/messages" target="_blank" rel="noopener">/api/messages</a> · 会话：<a class="meta-link" href="/api/threads" target="_blank" rel="noopener">/api/threads</a></div>
		        </div>
		        <div class="meta" id="statusText"></div>
		      </div>
			      <div id="list"></div>
			    </div>
			    <div id="rightbar" class="rightbar" aria-label="actions">
			      <button id="configToggleBtn" class="icon-btn" type="button" title="配置" aria-label="配置">⚙️</button>
			      <button id="startBtn" class="icon-btn" type="button" title="开始监听" aria-label="开始监听">▶️</button>
			      <button id="stopBtn" class="icon-btn" type="button" title="停止监听" aria-label="停止监听">⏹️</button>
			      <button id="clearBtn" class="icon-btn danger" type="button" title="清空显示" aria-label="清空显示">🧹</button>
			      <button id="shutdownBtn" class="icon-btn danger" type="button" title="退出 Sidecar" aria-label="退出 Sidecar">⏻</button>
			    </div>
			    <div id="drawerOverlay" class="drawer-overlay hidden"></div>
			    <div id="drawer" class="drawer hidden" role="dialog" aria-modal="true" aria-label="配置">
			      <div class="drawer-head">
			        <div class="title">配置</div>
			        <button id="drawerCloseBtn" class="drawer-close" type="button" title="关闭">×</button>
			      </div>
			      <details class="drawer-sec" open>
			        <summary>基础</summary>
			        <div class="grid">
			          <div class="meta">配置目录（只读）</div><div><input id="cfgHome" readonly /></div>
			          <div class="meta">监视目录（CODEX_HOME）</div><div><input id="watchHome" placeholder="/home/kino/.codex 或 /mnt/c/Users/.../.codex" /></div>
			        </div>
			      </details>
			      <details class="drawer-sec">
			        <summary>监听</summary>
			        <div class="grid">
			          <div class="meta">自动开始监听</div><div><select id="autoStart"><option value="0">否</option><option value="1">是</option></select></div>
			          <div class="meta">基于 Codex 进程定位</div><div><select id="followProc"><option value="0">否</option><option value="1">是</option></select></div>
			          <div class="meta">仅在检测到进程时跟随</div><div><select id="onlyWhenProc"><option value="1">是</option><option value="0">否</option></select></div>
			          <div class="meta">进程匹配（regex）</div><div><input id="procRegex" placeholder="codex" /></div>
			          <div class="meta">回放行数</div><div><input id="replayLines" type="number" min="0" step="1" /></div>
			          <div class="meta">采集 agent_reasoning</div><div><select id="includeAgent"><option value="0">否</option><option value="1">是</option></select></div>
			          <div class="meta">显示模式</div><div><select id="displayMode"><option value="both">中英文对照</option><option value="zh">仅中文</option><option value="en">仅英文</option></select></div>
			          <div class="meta">poll_interval（秒）</div><div><input id="pollInterval" type="number" min="0.05" step="0.05" /></div>
			          <div class="meta">file_scan_interval（秒）</div><div><input id="scanInterval" type="number" min="0.2" step="0.1" /></div>
			        </div>
			      </details>
			      <details class="drawer-sec">
			        <summary>翻译</summary>
			        <div class="grid">
			          <div class="meta">Provider</div><div><select id="translator"></select></div>
			          <div class="meta">HTTP Profiles</div><div style="display:flex; gap:8px; align-items:center;"><select id="httpProfile" style="flex:1;"></select><button id="httpProfileAddBtn" type="button">新增</button><button id="httpProfileRenameBtn" type="button">重命名</button><button id="httpProfileDelBtn" type="button">删除</button></div>
			          <div class="meta">HTTP URL</div><div><input id="httpUrl" placeholder="https://api.deeplx.org/{token}/translate 或 http://127.0.0.1:9000/translate" /></div>
			          <div class="meta">HTTP Token</div><div><input id="httpToken" placeholder="可用于 Authorization 或替换 URL 中的 {token}" /></div>
			          <div class="meta">HTTP 超时（秒）</div><div><input id="httpTimeout" type="number" min="0.5" step="0.5" /></div>
			          <div class="meta">Auth ENV</div><div><input id="httpAuthEnv" placeholder="CODEX_TRANSLATE_TOKEN" /></div>
			        </div>
			      </details>
			      <div class="btns">
			        <button class="primary" id="saveBtn" type="button">保存配置</button>
			        <button id="recoverBtn" type="button">恢复配置</button>
			      </div>
			      <details id="debugDetails" style="margin-top:8px;">
			        <summary class="meta">调试信息（配置加载/缓存排查）</summary>
			        <pre id="debugText" class="meta" style="white-space:pre-wrap; user-select:text;"></pre>
			      </details>
			    </div>
			    <div class="float-nav" aria-label="scroll">
			      <button id="scrollTopBtn" type="button" title="回到页面顶部">↑</button>
			      <button id="scrollBottomBtn" type="button" title="回到页面底部">↓</button>
			    </div>
	    <script type="module" src="/ui/app.js"></script>
  </body>
</html>
